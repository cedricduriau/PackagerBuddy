#!/usr/bin/env python

# stdlib modules
from __future__ import absolute_import
import argparse

# tool modules
from packagerbuddy import packagerbuddy


def _build_parser():
    """
    Builds the command line interface.

    :rtype: argparse.ArgumentParser
    """
    parser = argparse.ArgumentParser()
    subparsers = parser.add_subparsers()

    # ========================================================================
    # install
    # ========================================================================
    parser_install = subparsers.add_parser("install")
    parser_install.set_defaults(which="install")

    # required arguments
    req_args = parser_install.add_argument_group("required arguments")

    help = "name of the software to install"
    req_args.add_argument("-s", "--software", required=True, help=help)

    help = "version of the software to install"
    req_args.add_argument("-v", "--version", required=True, help=help)

    # ========================================================================
    # list
    # ========================================================================
    parser_list = subparsers.add_parser("list")
    parser_list.set_defaults(which="list")

    # ========================================================================
    # avail
    # ========================================================================
    parser_avail = subparsers.add_parser("avail")
    parser_avail.set_defaults(which="avail")

    return parser


if __name__ == "__main__":
    parser = _build_parser()
    namespace = parser.parse_args()
    action = namespace.which

    if action == "install":
        packagerbuddy.install(namespace.software, namespace.version)
    elif action == "list":
        msg = "No installed software found."
        installed = packagerbuddy.get_installed_software()
        if installed:
            msg = "\n".join(["- " + i for i in installed])
        print(msg)
    elif action == "avail":
        msg = "No software configs available."
        configs = packagerbuddy.get_configs()
        if configs:
            names = map(packagerbuddy.get_software_from_config, configs)
            msg = "\n".join(["- " + i for i in names])
        print(msg)
